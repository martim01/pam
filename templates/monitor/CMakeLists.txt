cmake_minimum_required(VERSION 3.5 FATAL_ERROR)
project(monitormaker VERSION 0.1)

SET(DIR_PLUGINS $ENV{HOME}/pam/plugins CACHE STRING "location for new project")
OPTION(METER "Create meter style" ON)
OPTION(FFT "Use FFT library" OFF)
OPTION(LEVEL "Use level library" OFF)

if( PLUGIN )
    configure_file(builder.cpp.in ${DIR_PLUGINS}/${PLUGIN}/builder.cpp @ONLY)
    configure_file(builder.h.in ${DIR_PLUGINS}/${PLUGIN}/builder.h @ONLY)
    configure_file(register.cpp.in ${DIR_PLUGINS}/${PLUGIN}/register.cpp @ONLY)
    configure_file(register.h.in ${DIR_PLUGINS}/${PLUGIN}/register.h @ONLY)

    if(FFT)
        SET(FFT_GUARD_OPEN "")
        SET(FFT_GUARD_CLOSE "")
        SET(FFT_LIB "target_link_libraries(${PLUGIN} optimized pamfft debug pamfftd)")
    else()
        SET(FFT_GUARD_OPEN "<!--")
        SET(FFT_GUARD_CLOSE "-->")
    endif()

    if(LEVEL)
        SET(LEVEL_GUARD_OPEN "")
        SET(LEVEL_GUARD_CLOSE "")
        SET(LEVEL_LIB "target_link_libraries(${PLUGIN} optimized pamlevel debug pamleveld)")
    else()
        SET(LEVEL_GUARD_OPEN "<!--")
        SET(LEVEL_GUARD_CLOSE "-->")
    endif()

    if( METER)
        SET(DISPLAY_TYPE "Meter")
        SET(DISPLAY_FILE "meter")
        configure_file(meter/meter.cpp.in ${DIR_PLUGINS}/${PLUGIN}/meter.cpp @ONLY)
        configure_file(meter/meter.h.in ${DIR_PLUGINS}/${PLUGIN}/meter.h @ONLY)
    else()
        SET(DISPLAY_TYPE "Panel")
        SET(DISPLAY_FILE "panel")
        SET(PANEL_WXS "<wxsmith version=\"1\">
        <resources>
            <wxPanel wxs=\"wxsmith/${PLUGIN}panel.wxs\" src=\"${PLUGIN}panel.cpp\" hdr=\"${PLUGIN}panel.h\" fwddecl=\"0\" i18n=\"1\" name=\"${PLUGIN}Panel\" language=\"CPP\" />
        </resources>
    </wxsmith> ")
        configure_file(panel/panel.cpp.in ${DIR_PLUGINS}/${PLUGIN}/panel.cpp @ONLY)
        configure_file(panel/panel.h.in ${DIR_PLUGINS}/${PLUGIN}/panel.h @ONLY)
        configure_file(panel/wxsmith/panel.wxs.in ${DIR_PLUGINS}/${PLUGIN}/wxsmith/panel.wxs @ONLY)
    endif()
    configure_file(project.xml.in ${DIR_PLUGINS}/${PLUGIN}/${PLUGIN}.cbp @ONLY)
    configure_file(CMakeLists.txt.in ${DIR_PLUGINS}/${PLUGIN}/CMakeLists.txt @ONLY)
else()
    message(FATAL_ERROR "No plugin name defined!")
endif()

unset(METER)
unset(FFT)
unset(LEVEL)
