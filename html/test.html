<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 5.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
	<head>
		<meta name="description" content="" >
		<meta name="author" content="Matthew Martin">
		<meta name="keywords" content="" >
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<meta http-equiv="Expires" content="Mon, 26 Jul 1980 05:00:00 GMT">
		<meta http-equiv="Expires" content="0">
		<meta http-equiv="pragma" content="no-cache">
		<meta http-equiv="Cache-Control" content="no-cache, must-revalidate, post-check=0, pre-check=0">
		<meta http-equiv="Cache-Control" content="max-age=0">
		<title>ePI</title>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.4/raphael-min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.2.9/justgage.min.js"></script>
		<script type="text/javascript" language="javascript">
			
			var url = new URL(window.location.href);
			var g_endpoint = url.searchParams.get("endpoint");
			
			
			console.log(g_endpoint);
			if(g_endpoint === null)
			{
				g_endpoint = prompt("Enter endpoint");
			}
			
			var g_url = "http://"+g_endpoint+"/x-pam";
			
			
			

			function ws_connect()
			{
				console.log("ws_connect: "+ g_endpoint+"/x-pam/monitor");
				g_ws = new WebSocket('ws://'+ g_endpoint+"/x-pam/monitor");
				
				g_ws.onopen = function(ev)  { console.log(ev); };
				g_ws.onerror = function(ev) { console.log(ev); };
				g_ws.onclose = function(ev) { console.log(ev); alert("Server has closed");};
				//g_ws.filter = function(jsonObj){};
	
							
				g_ws.onmessage = function(ev) 
				{
					var jsonObj = JSON.parse(ev.data);
					console.log(jsonObj);
					if(jsonObj["plugin"]["name"] == "Meters")
					{
						document.getElementById("left").value = jsonObj["data"][0]["level"];
						document.getElementById("right").value = jsonObj["data"][1]["level"];
						document.getElementById("mid").value = jsonObj["data"][2]["level"];
						document.getElementById("side").value = jsonObj["data"][3]["level"];
					}
					
                }
            }

	

        </script>
    </head>
    <body onload="ws_connect()">
		<div><meter id="left" min="-90" low="-40" high="-18" max="0" value="-90"> L</div>
		<div><meter id="right" min="-90" low="-40" high="-18" max="0" value="-90"> R</div>
		<div><meter id="mid" min="-90" low="-40" high="-18" max="0" value="-90"> M</div>
		<div><meter id="side" min="-90" low="-40" high="-18" max="0" value="-90"> S</div>
    </body>
</HTML>